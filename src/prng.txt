; PRNG comes from a combination of Perlin noise
; and 8-bit xorshift.
; inspired by Hugo Elias and Patrik Rak.

    .area _CODE ; not necessary but safer

    ; operation operand ; cycle count

_prng::
    ld hl,0xA280 ; yw -> zt
    ld de,0xC0DE ; xz -> yw
    ld (rnd+4),hl ; x = y, z = w
    ld a,l ; w = w ^ ( w << 3 )
    add a,a
    add a,a
    add a,a
    xor l
    ld l,a
    ld a,d ; t = x ^ (x << 1)
    add a,a
    xor d
    ld h,a
    rra ; t = t ^ (t >> 1) ^ w
    xor h
    xor l
    ld h,e ; y = z
    ld l,a ; w = t
    ld (rnd+1),hl
    ld c,a
    ld b,0
    ret
